generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Account {
  id                String  @id
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
}

model AccountingAlert {
  id         String    @id
  type       String
  severity   String    @default("MEDIUM")
  title      String
  message    String
  entityType String?
  entityId   String?
  link       String?
  readAt     DateTime?
  readBy     String?
  resolvedAt DateTime?
  resolvedBy String?
  createdAt  DateTime  @default(now())

  @@index([createdAt])
  @@index([severity])
  @@index([type])
}

model AccountingPeriod {
  id               String    @id
  name             String
  code             String    @unique
  startDate        DateTime
  endDate          DateTime
  status           String    @default("OPEN")
  closedAt         DateTime?
  closedBy         String?
  closingChecklist String?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime

  @@index([startDate])
  @@index([status])
}

model AccountingSettings {
  id                    String   @id @default("default")
  companyName           String   @default("BioCycle Peptides Inc.")
  companyAddress        String?
  companyCity           String   @default("Montr√©al")
  companyProvince       String   @default("QC")
  companyPostalCode     String?
  companyPhone          String?
  companyEmail          String?
  tpsNumber             String?
  tvqNumber             String?
  neq                   String?
  fiscalYearStart       Int      @default(1)
  accountingMethod      String   @default("ACCRUAL")
  defaultCurrency       String   @default("CAD")
  taxFilingFrequency    String   @default("MONTHLY")
  autoCreateSaleEntries Boolean  @default(true)
  autoReconcileStripe   Boolean  @default(true)
  updatedAt             DateTime
}

model Ambassador {
  id             String                 @id
  userId         String?
  name           String
  email          String?
  phone          String?
  referralCode   String                 @unique
  commissionRate Decimal                @default(10) @db.Decimal(5, 2)
  totalReferrals Int                    @default(0)
  totalEarnings  Decimal                @default(0) @db.Decimal(12, 2)
  status         String                 @default("ACTIVE")
  tier           String                 @default("BRONZE")
  joinedAt       DateTime               @default(now())
  createdAt      DateTime               @default(now())
  updatedAt      DateTime
  user           User?                  @relation(fields: [userId], references: [id])
  commissions    AmbassadorCommission[]
  payouts        AmbassadorPayout[]

  @@index([referralCode])
  @@index([status])
  @@index([userId])
}

model AmbassadorCommission {
  id               String            @id
  ambassadorId     String
  orderId          String
  orderNumber      String
  orderTotal       Decimal           @db.Decimal(10, 2)
  commissionRate   Decimal           @db.Decimal(5, 2)
  commissionAmount Decimal           @db.Decimal(10, 2)
  paidOut          Boolean           @default(false)
  paidOutAt        DateTime?
  payoutId         String?
  createdAt        DateTime          @default(now())
  ambassador       Ambassador        @relation(fields: [ambassadorId], references: [id], onDelete: Cascade)
  payout           AmbassadorPayout? @relation(fields: [payoutId], references: [id])

  @@unique([ambassadorId, orderId])
  @@index([ambassadorId])
  @@index([paidOut])
  @@index([payoutId])
}

model AmbassadorPayout {
  id            String                 @id
  ambassadorId  String
  amount        Decimal                @db.Decimal(10, 2)
  method        String?
  reference     String?
  notes         String?
  processedById String?
  createdAt     DateTime               @default(now())
  commissions   AmbassadorCommission[]
  ambassador    Ambassador             @relation(fields: [ambassadorId], references: [id], onDelete: Cascade)

  @@index([ambassadorId])
}

model Article {
  id              String               @id
  title           String
  slug            String               @unique
  excerpt         String?
  content         String?
  imageUrl        String?
  author          String?
  category        String?
  tags            String?
  readTime        Int?
  difficulty      String?
  isFeatured      Boolean              @default(false)
  isPublished     Boolean              @default(false)
  publishedAt     DateTime?
  locale          String               @default("en")
  metaTitle       String?
  metaDescription String?
  createdAt       DateTime             @default(now())
  updatedAt       DateTime
  translations    ArticleTranslation[]

  @@index([category])
  @@index([isPublished])
  @@index([slug])
}

model ArticleTranslation {
  id              String             @id
  articleId       String
  locale          String
  title           String?
  excerpt         String?
  content         String?
  metaTitle       String?
  metaDescription String?
  contentHash     String?
  translatedBy    String?            @default("gpt-4o-mini")
  isApproved      Boolean            @default(false)
  createdAt       DateTime           @default(now())
  updatedAt       DateTime
  qualityLevel    TranslationQuality @default(draft)
  article         Article            @relation(fields: [articleId], references: [id], onDelete: Cascade)

  @@unique([articleId, locale])
  @@index([articleId])
  @@index([locale])
}

model AuditLog {
  id         String   @id
  userId     String?
  action     String
  entityType String
  entityId   String?
  details    String?
  ipAddress  String?
  userAgent  String?
  createdAt  DateTime @default(now())

  @@index([action])
  @@index([createdAt])
  @@index([entityType])
  @@index([userId])
}

model BankAccount {
  id             String            @id
  name           String
  accountNumber  String?
  institution    String
  type           String            @default("CHECKING")
  currency       String            @default("CAD")
  chartAccountId String?
  currentBalance Decimal           @default(0) @db.Decimal(12, 2)
  lastSyncAt     DateTime?
  apiCredentials String?
  isActive       Boolean           @default(true)
  isDefault      Boolean           @default(false)
  createdAt      DateTime          @default(now())
  updatedAt      DateTime
  transactions   BankTransaction[]

  @@index([type])
}

model BankTransaction {
  id                   String               @id
  bankAccountId        String
  date                 DateTime
  description          String
  amount               Decimal              @db.Decimal(12, 2)
  type                 String
  category             String?
  reference            String?
  reconciliationStatus ReconciliationStatus @default(PENDING)
  matchedEntryId       String?
  matchedAt            DateTime?
  matchedBy            String?
  importBatch          String?
  importedAt           DateTime             @default(now())
  rawData              String?
  createdAt            DateTime             @default(now())
  bankAccount          BankAccount          @relation(fields: [bankAccountId], references: [id], onDelete: Cascade)

  @@index([bankAccountId])
  @@index([date])
  @@index([reconciliationStatus])
}

model BlogPost {
  id              String                @id
  title           String
  slug            String                @unique
  excerpt         String?
  content         String?
  imageUrl        String?
  author          String?
  category        String?
  tags            String?
  readTime        Int?
  isFeatured      Boolean               @default(false)
  isPublished     Boolean               @default(false)
  publishedAt     DateTime?
  locale          String                @default("en")
  metaTitle       String?
  metaDescription String?
  createdAt       DateTime              @default(now())
  updatedAt       DateTime
  translations    BlogPostTranslation[]

  @@index([category])
  @@index([isPublished])
  @@index([slug])
}

model BlogPostTranslation {
  id              String             @id
  blogPostId      String
  locale          String
  title           String?
  excerpt         String?
  content         String?
  metaTitle       String?
  metaDescription String?
  contentHash     String?
  translatedBy    String?            @default("gpt-4o-mini")
  isApproved      Boolean            @default(false)
  createdAt       DateTime           @default(now())
  updatedAt       DateTime
  qualityLevel    TranslationQuality @default(draft)
  blogPost        BlogPost           @relation(fields: [blogPostId], references: [id], onDelete: Cascade)

  @@unique([blogPostId, locale])
  @@index([blogPostId])
  @@index([locale])
}

model Budget {
  id        String       @id
  name      String
  year      Int
  isActive  Boolean      @default(true)
  createdAt DateTime     @default(now())
  updatedAt DateTime
  lines     BudgetLine[]

  @@index([year])
}

model BudgetLine {
  id          String   @id
  budgetId    String
  accountCode String
  accountName String
  type        String   @default("EXPENSE")
  january     Decimal  @default(0) @db.Decimal(12, 2)
  february    Decimal  @default(0) @db.Decimal(12, 2)
  march       Decimal  @default(0) @db.Decimal(12, 2)
  april       Decimal  @default(0) @db.Decimal(12, 2)
  may         Decimal  @default(0) @db.Decimal(12, 2)
  june        Decimal  @default(0) @db.Decimal(12, 2)
  july        Decimal  @default(0) @db.Decimal(12, 2)
  august      Decimal  @default(0) @db.Decimal(12, 2)
  september   Decimal  @default(0) @db.Decimal(12, 2)
  october     Decimal  @default(0) @db.Decimal(12, 2)
  november    Decimal  @default(0) @db.Decimal(12, 2)
  december    Decimal  @default(0) @db.Decimal(12, 2)
  total       Decimal  @default(0) @db.Decimal(12, 2)
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  budget      Budget   @relation(fields: [budgetId], references: [id], onDelete: Cascade)

  @@index([accountCode])
  @@index([budgetId])
}

model Bundle {
  id          String       @id
  name        String
  slug        String       @unique
  description String?
  image       String?
  discount    Decimal      @default(0) @db.Decimal(5, 2)
  isActive    Boolean      @default(true)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime
  items       BundleItem[]

  @@index([isActive])
  @@index([slug])
}

model BundleItem {
  id        String  @id
  bundleId  String
  productId String
  formatId  String?
  quantity  Int     @default(1)
  bundle    Bundle  @relation(fields: [bundleId], references: [id], onDelete: Cascade)
  product   Product @relation(fields: [productId], references: [id])

  @@index([bundleId])
}

model Cart {
  id           String     @id
  userId       String?    @unique
  sessionId    String?    @unique
  currencyCode String     @default("CAD")
  promoCodeId  String?
  expiresAt    DateTime?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime
  items        CartItem[]

  @@index([sessionId])
  @@index([userId])
}

model CartItem {
  id         String   @id
  cartId     String
  productId  String
  formatId   String?
  quantity   Int      @default(1)
  priceAtAdd Decimal  @db.Decimal(10, 2)
  createdAt  DateTime @default(now())
  updatedAt  DateTime
  cart       Cart     @relation(fields: [cartId], references: [id], onDelete: Cascade)

  @@unique([cartId, productId, formatId])
  @@index([cartId])
  @@index([productId])
}

model Category {
  id           String                @id
  name         String
  slug         String                @unique
  description  String?
  imageUrl     String?
  sortOrder    Int                   @default(0)
  isActive     Boolean               @default(true)
  createdAt    DateTime              @default(now())
  updatedAt    DateTime
  translations CategoryTranslation[]
  products     Product[]

  @@index([slug])
}

model CategoryTranslation {
  id           String             @id
  categoryId   String
  locale       String
  name         String?
  description  String?
  contentHash  String?
  translatedBy String?            @default("gpt-4o-mini")
  isApproved   Boolean            @default(false)
  createdAt    DateTime           @default(now())
  updatedAt    DateTime
  qualityLevel TranslationQuality @default(draft)
  category     Category           @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@unique([categoryId, locale])
  @@index([categoryId])
  @@index([locale])
}

model ChartOfAccount {
  id               String           @id
  code             String           @unique
  name             String
  description      String?
  type             AccountType
  parentId         String?
  normalBalance    String           @default("DEBIT")
  isActive         Boolean          @default(true)
  isSystem         Boolean          @default(false)
  allowDirectEntry Boolean          @default(true)
  createdAt        DateTime         @default(now())
  updatedAt        DateTime
  parent           ChartOfAccount?  @relation("ChartOfAccountToChartOfAccount", fields: [parentId], references: [id])
  children         ChartOfAccount[] @relation("ChartOfAccountToChartOfAccount")
  journalLines     JournalLine[]

  @@index([parentId])
  @@index([type])
}

model ChatConversation {
  id              String        @id
  visitorId       String
  visitorName     String?
  visitorEmail    String?
  visitorLanguage String        @default("en")
  userId          String?
  status          ChatStatus    @default(ACTIVE)
  isOnline        Boolean       @default(true)
  userAgent       String?
  ipCountry       String?
  currentPage     String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime
  lastMessageAt   DateTime      @default(now())
  closedAt        DateTime?
  messages        ChatMessage[]

  @@index([lastMessageAt])
  @@index([status])
  @@index([userId])
  @@index([visitorId])
}

model ChatMessage {
  id              String           @id
  conversationId  String
  content         String
  contentOriginal String?
  sender          ChatSender
  senderName      String?
  language        String           @default("en")
  translatedTo    String?
  isRead          Boolean          @default(false)
  isFromBot       Boolean          @default(false)
  metadata        String?
  createdAt       DateTime         @default(now())
  conversation    ChatConversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  @@index([conversationId])
  @@index([createdAt])
}

model ChatSettings {
  id                 String   @id @default("default")
  isAdminOnline      Boolean  @default(false)
  adminLanguage      String   @default("fr")
  chatbotEnabled     Boolean  @default(true)
  chatbotGreeting    String?
  chatbotPrompt      String?
  notifyEmail        String?
  notifyOnNewChat    Boolean  @default(true)
  notifyOnEscalation Boolean  @default(true)
  widgetColor        String   @default("#f97316")
  widgetPosition     String   @default("bottom-right")
  updatedAt          DateTime
}

model ClientReference {
  id          String   @id
  name        String
  logoUrl     String?
  industry    String?
  website     String?
  description String?
  isPublished Boolean  @default(true)
  sortOrder   Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime

  @@index([industry])
  @@index([isPublished])
}

model Company {
  id             String            @id
  name           String
  slug           String            @unique
  contactEmail   String
  phone          String?
  billingAddress String?
  billingCity    String?
  billingState   String?
  billingPostal  String?
  billingCountry String?
  ownerId        String            @unique
  isActive       Boolean           @default(true)
  createdAt      DateTime          @default(now())
  updatedAt      DateTime
  owner          User              @relation(fields: [ownerId], references: [id])
  customers      CompanyCustomer[]
  purchases      Purchase[]

  @@index([slug])
}

model CompanyCustomer {
  id         String   @id
  companyId  String
  customerId String
  addedAt    DateTime @default(now())
  addedBy    String?
  company    Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  user       User     @relation(fields: [customerId], references: [id], onDelete: Cascade)

  @@unique([companyId, customerId])
  @@index([companyId])
  @@index([customerId])
}

model Conversation {
  id            String             @id
  userId        String
  subject       String?
  status        ConversationStatus @default(OPEN)
  assignedToId  String?
  priority      Int                @default(0)
  tags          String?
  lastMessageAt DateTime           @default(now())
  unreadCount   Int                @default(1)
  createdAt     DateTime           @default(now())
  updatedAt     DateTime
  assignedTo    User?              @relation("Conversation_assignedToIdToUser", fields: [assignedToId], references: [id])
  user          User               @relation("Conversation_userIdToUser", fields: [userId], references: [id], onDelete: Cascade)
  messages      Message[]

  @@index([assignedToId])
  @@index([lastMessageAt])
  @@index([status])
  @@index([userId])
}

model CourseAccess {
  id                  String    @id
  userId              String
  productId           String
  purchaseId          String    @unique
  progress            Int       @default(0)
  lastAccessedAt      DateTime?
  completedAt         DateTime?
  certificateUrl      String?
  certificateNumber   String?
  certificateIssuedAt DateTime?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime
  product             Product   @relation(fields: [productId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  purchase            Purchase  @relation(fields: [purchaseId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  user                User      @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([userId, productId])
  @@index([productId])
  @@index([userId])
}

model CreditNote {
  id               String           @id
  creditNoteNumber String           @unique
  invoiceId        String?
  orderId          String?
  customerName     String
  customerEmail    String?
  subtotal         Decimal          @db.Decimal(12, 2)
  taxTps           Decimal          @default(0) @db.Decimal(12, 2)
  taxTvq           Decimal          @default(0) @db.Decimal(12, 2)
  taxTvh           Decimal          @default(0) @db.Decimal(12, 2)
  total            Decimal          @db.Decimal(12, 2)
  currency         String           @default("CAD")
  reason           String
  status           CreditNoteStatus @default(DRAFT)
  issuedAt         DateTime?
  issuedBy         String?
  voidedAt         DateTime?
  voidedBy         String?
  journalEntryId   String?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime
  taxPst           Decimal          @default(0) @db.Decimal(12, 2)
  invoice          CustomerInvoice? @relation(fields: [invoiceId], references: [id])

  @@index([createdAt])
  @@index([invoiceId])
  @@index([orderId])
  @@index([status])
}

model Currency {
  id            String   @id
  code          String   @unique
  name          String
  symbol        String
  exchangeRate  Decimal  @default(1.000000) @db.Decimal(10, 6)
  rateUpdatedAt DateTime @default(now())
  isDefault     Boolean  @default(false)
  isActive      Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime
  orders        Order[]

  @@index([code])
}

model CustomerInvoice {
  id              String                @id
  invoiceNumber   String                @unique
  customerId      String?
  customerName    String
  customerEmail   String?
  customerAddress String?
  orderId         String?
  subtotal        Decimal               @db.Decimal(12, 2)
  shippingCost    Decimal               @default(0) @db.Decimal(12, 2)
  discount        Decimal               @default(0) @db.Decimal(12, 2)
  taxTps          Decimal               @default(0) @db.Decimal(12, 2)
  taxTvq          Decimal               @default(0) @db.Decimal(12, 2)
  taxTvh          Decimal               @default(0) @db.Decimal(12, 2)
  total           Decimal               @db.Decimal(12, 2)
  amountPaid      Decimal               @default(0) @db.Decimal(12, 2)
  balance         Decimal               @db.Decimal(12, 2)
  currency        String                @default("CAD")
  invoiceDate     DateTime
  dueDate         DateTime
  paidAt          DateTime?
  status          InvoiceStatus         @default(SENT)
  pdfUrl          String?
  notes           String?
  remindersSent   Int                   @default(0)
  lastReminderAt  DateTime?
  journalEntryId  String?
  createdAt       DateTime              @default(now())
  updatedAt       DateTime
  taxPst          Decimal               @default(0) @db.Decimal(12, 2)
  creditNotes     CreditNote[]
  items           CustomerInvoiceItem[]

  @@index([customerId])
  @@index([dueDate])
  @@index([orderId])
  @@index([status])
}

model CustomerInvoiceItem {
  id          String          @id
  invoiceId   String
  description String
  quantity    Int             @default(1)
  unitPrice   Decimal         @db.Decimal(12, 2)
  discount    Decimal         @default(0) @db.Decimal(12, 2)
  total       Decimal         @db.Decimal(12, 2)
  productId   String?
  productSku  String?
  createdAt   DateTime        @default(now())
  invoice     CustomerInvoice @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  @@index([invoiceId])
}

model Discount {
  id           String       @id
  name         String
  type         DiscountType @default(PERCENTAGE)
  value        Decimal      @db.Decimal(10, 2)
  appliesToAll Boolean      @default(false)
  categoryId   String?
  productId    String?
  startsAt     DateTime?
  endsAt       DateTime?
  badge        String?
  badgeColor   String?
  isActive     Boolean      @default(true)
  createdAt    DateTime     @default(now())
  updatedAt    DateTime

  @@index([categoryId])
  @@index([isActive])
  @@index([productId])
  @@index([startsAt, endsAt])
}

model EmailLog {
  id         String   @id
  templateId String?
  to         String
  subject    String
  status     String   @default("sent")
  error      String?
  sentAt     DateTime @default(now())

  @@index([sentAt])
  @@index([to])
}

model EmailTemplate {
  id          String   @id
  name        String   @unique
  subject     String
  htmlContent String
  textContent String?
  variables   String[]
  isActive    Boolean  @default(true)
  locale      String   @default("fr")
  createdAt   DateTime @default(now())
  updatedAt   DateTime
}

model Faq {
  id           String           @id
  question     String
  answer       String
  category     String           @default("general")
  locale       String           @default("en")
  sortOrder    Int              @default(0)
  isPublished  Boolean          @default(true)
  createdAt    DateTime         @default(now())
  updatedAt    DateTime
  translations FaqTranslation[]

  @@index([category])
  @@index([isPublished])
}

model FaqTranslation {
  id           String             @id
  faqId        String
  locale       String
  question     String
  answer       String
  createdAt    DateTime           @default(now())
  updatedAt    DateTime
  contentHash  String?
  translatedBy String?            @default("gpt-4o-mini")
  isApproved   Boolean            @default(false)
  qualityLevel TranslationQuality @default(draft)
  faq          Faq                @relation(fields: [faqId], references: [id], onDelete: Cascade)

  @@unique([faqId, locale])
  @@index([faqId])
  @@index([locale])
}

model GiftCard {
  id             String    @id
  code           String    @unique
  initialAmount  Decimal   @db.Decimal(10, 2)
  balance        Decimal   @db.Decimal(10, 2)
  currency       String    @default("CAD")
  purchaserId    String?
  recipientEmail String?
  recipientName  String?
  message        String?
  isActive       Boolean   @default(true)
  expiresAt      DateTime?
  redeemedBy     String?
  createdAt      DateTime  @default(now())
  purchaser      User?     @relation("GiftCard_purchaserIdToUser", fields: [purchaserId], references: [id])
  redeemer       User?     @relation("GiftCard_redeemedByToUser", fields: [redeemedBy], references: [id])

  @@index([code])
  @@index([purchaserId])
}

model Grade {
  id          String   @id
  userId      String
  productId   String
  moduleId    String
  score       Decimal  @db.Decimal(5, 2)
  passed      Boolean
  attempts    Int      @default(1)
  completedAt DateTime @default(now())
  module      Module   @relation(fields: [moduleId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  product     Product  @relation(fields: [productId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  user        User     @relation(fields: [userId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@unique([userId, moduleId])
  @@index([productId])
  @@index([userId])
}

model Guide {
  id            String             @id
  title         String
  slug          String             @unique
  description   String?
  category      String             @default("general")
  fileUrl       String?
  thumbnailUrl  String?
  format        String?
  pageCount     Int?
  isFeatured    Boolean            @default(false)
  isPublished   Boolean            @default(false)
  locale        String             @default("en")
  downloadCount Int                @default(0)
  createdAt     DateTime           @default(now())
  updatedAt     DateTime
  translations  GuideTranslation[]

  @@index([category])
  @@index([isPublished])
  @@index([slug])
}

model GuideTranslation {
  id           String             @id
  guideId      String
  locale       String
  title        String?
  description  String?
  createdAt    DateTime           @default(now())
  updatedAt    DateTime
  contentHash  String?
  translatedBy String?            @default("gpt-4o-mini")
  isApproved   Boolean            @default(false)
  qualityLevel TranslationQuality @default(draft)
  guide        Guide              @relation(fields: [guideId], references: [id], onDelete: Cascade)

  @@unique([guideId, locale])
  @@index([guideId])
}

model HeroSlide {
  id               String                 @id
  slug             String                 @unique
  mediaType        HeroMediaType          @default(IMAGE)
  backgroundUrl    String
  backgroundMobile String?
  overlayOpacity   Int                    @default(70)
  overlayGradient  String?
  badgeText        String?
  title            String
  subtitle         String?
  ctaText          String?
  ctaUrl           String?
  ctaStyle         String?                @default("primary")
  cta2Text         String?
  cta2Url          String?
  cta2Style        String?                @default("outline")
  statsJson        String?
  sortOrder        Int                    @default(0)
  isActive         Boolean                @default(true)
  startDate        DateTime?
  endDate          DateTime?
  createdAt        DateTime               @default(now())
  updatedAt        DateTime
  translations     HeroSlideTranslation[]

  @@index([isActive, sortOrder])
}

model HeroSlideTranslation {
  id           String             @id
  slideId      String
  locale       String
  badgeText    String?
  title        String
  subtitle     String?
  ctaText      String?
  cta2Text     String?
  statsJson    String?
  createdAt    DateTime           @default(now())
  updatedAt    DateTime
  contentHash  String?
  translatedBy String?            @default("gpt-4o-mini")
  isApproved   Boolean            @default(false)
  qualityLevel TranslationQuality @default(draft)
  heroSlide    HeroSlide          @relation(fields: [slideId], references: [id], onDelete: Cascade)

  @@unique([slideId, locale])
  @@index([locale])
  @@index([slideId])
}

model InventoryReservation {
  id         String                     @id
  productId  String
  formatId   String?
  quantity   Int
  orderId    String?
  cartId     String?
  status     InventoryReservationStatus @default(RESERVED)
  expiresAt  DateTime
  createdAt  DateTime                   @default(now())
  consumedAt DateTime?
  releasedAt DateTime?

  @@index([cartId])
  @@index([expiresAt])
  @@index([orderId])
  @@index([status])
}

model InventoryTransaction {
  id                String                   @id
  productId         String
  formatId          String?
  type              InventoryTransactionType
  quantity          Int
  unitCost          Decimal                  @db.Decimal(12, 4)
  runningWAC        Decimal                  @db.Decimal(12, 4)
  orderId           String?
  supplierInvoiceId String?
  reason            String?
  createdBy         String?
  createdAt         DateTime                 @default(now())

  @@index([createdAt])
  @@index([orderId])
  @@index([productId, formatId])
  @@index([type])
}

model JournalEntry {
  id           String             @id
  entryNumber  String             @unique
  date         DateTime
  description  String
  type         JournalEntryType   @default(MANUAL)
  status       JournalEntryStatus @default(DRAFT)
  reference    String?
  orderId      String?
  createdBy    String
  postedBy     String?
  postedAt     DateTime?
  voidedBy     String?
  voidedAt     DateTime?
  voidReason   String?
  attachments  String?
  createdAt    DateTime           @default(now())
  updatedAt    DateTime
  currency     String             @default("CAD")
  exchangeRate Decimal            @default(1.000000) @db.Decimal(10, 6)
  lines        JournalLine[]

  @@index([date])
  @@index([orderId])
  @@index([status])
  @@index([type])
}

model JournalLine {
  id          String         @id
  entryId     String
  accountId   String
  description String?
  debit       Decimal        @default(0) @db.Decimal(12, 2)
  credit      Decimal        @default(0) @db.Decimal(12, 2)
  costCenter  String?
  projectCode String?
  createdAt   DateTime       @default(now())
  account     ChartOfAccount @relation(fields: [accountId], references: [id])
  entry       JournalEntry   @relation(fields: [entryId], references: [id], onDelete: Cascade)

  @@index([accountId])
  @@index([entryId])
}

model LoyaltyTransaction {
  id           String                 @id
  userId       String
  type         LoyaltyTransactionType
  points       Int
  description  String?
  orderId      String?
  referralId   String?
  balanceAfter Int
  metadata     String?
  createdAt    DateTime               @default(now())
  expiresAt    DateTime?
  user         User                   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([type])
  @@index([userId])
}

model Media {
  id           String   @id
  filename     String
  originalName String
  mimeType     String
  size         Int
  url          String
  alt          String?
  folder       String   @default("general")
  uploadedBy   String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime

  @@index([folder])
  @@index([mimeType])
}

model Message {
  id             String       @id
  conversationId String
  senderId       String
  type           MessageType  @default(TEXT)
  content        String
  attachmentUrl  String?
  attachmentName String?
  attachmentSize Int?
  readAt         DateTime?
  isSystem       Boolean      @default(false)
  createdAt      DateTime     @default(now())
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  sender         User         @relation(fields: [senderId], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([conversationId])
  @@index([createdAt])
  @@index([senderId])
}

model Module {
  id          String   @id
  productId   String
  name        String
  description String?
  sortOrder   Int      @default(0)
  duration    Int?
  contentUrl  String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  grades      Grade[]
  product     Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
}

model NewsArticle {
  id           String                   @id
  title        String
  slug         String                   @unique
  excerpt      String?
  content      String?
  imageUrl     String?
  type         String                   @default("news")
  author       String?
  isFeatured   Boolean                  @default(false)
  isPublished  Boolean                  @default(false)
  publishedAt  DateTime?
  locale       String                   @default("en")
  createdAt    DateTime                 @default(now())
  updatedAt    DateTime
  translations NewsArticleTranslation[]

  @@index([isPublished])
  @@index([slug])
  @@index([type])
}

model NewsArticleTranslation {
  id            String             @id
  newsArticleId String
  locale        String
  title         String?
  excerpt       String?
  content       String?
  createdAt     DateTime           @default(now())
  updatedAt     DateTime
  contentHash   String?
  translatedBy  String?            @default("gpt-4o-mini")
  isApproved    Boolean            @default(false)
  qualityLevel  TranslationQuality @default(draft)
  newsArticle   NewsArticle        @relation(fields: [newsArticleId], references: [id], onDelete: Cascade)

  @@unique([newsArticleId, locale])
  @@index([newsArticleId])
}

model NewsletterSubscriber {
  id             String    @id
  email          String    @unique
  name           String?
  isActive       Boolean   @default(true)
  source         String?
  locale         String    @default("fr")
  subscribedAt   DateTime  @default(now())
  unsubscribedAt DateTime?
  birthDate      DateTime?

  @@index([email])
  @@index([isActive])
}

model NotificationPreference {
  id             String   @id
  userId         String   @unique
  orderUpdates   Boolean  @default(true)
  promotions     Boolean  @default(true)
  newsletter     Boolean  @default(true)
  weeklyDigest   Boolean  @default(false)
  priceDrops     Boolean  @default(false)
  stockAlerts    Boolean  @default(true)
  productReviews Boolean  @default(false)
  birthdayOffers Boolean  @default(true)
  loyaltyUpdates Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Order {
  id                String          @id
  orderNumber       String          @unique
  userId            String
  subtotal          Decimal         @db.Decimal(10, 2)
  shippingCost      Decimal         @default(0) @db.Decimal(10, 2)
  discount          Decimal         @default(0) @db.Decimal(10, 2)
  tax               Decimal         @default(0) @db.Decimal(10, 2)
  total             Decimal         @db.Decimal(10, 2)
  currencyId        String
  exchangeRate      Decimal         @default(1) @db.Decimal(10, 6)
  promoCode         String?
  promoDiscount     Decimal?        @db.Decimal(10, 2)
  paymentMethod     PaymentMethod?
  paymentStatus     String          @default("PENDING")
  stripePaymentId   String?
  paypalOrderId     String?
  status            String          @default("PENDING")
  shippingName      String
  shippingAddress1  String
  shippingAddress2  String?
  shippingCity      String
  shippingState     String
  shippingPostal    String
  shippingCountry   String          @default("CA")
  shippingPhone     String?
  carrier           String?
  trackingNumber    String?
  trackingUrl       String?
  shippedAt         DateTime?
  deliveredAt       DateTime?
  customerNotes     String?
  adminNotes        String?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime
  taxTps            Decimal         @default(0) @db.Decimal(10, 2)
  taxTvh            Decimal         @default(0) @db.Decimal(10, 2)
  taxTvq            Decimal         @default(0) @db.Decimal(10, 2)
  orderType         String          @default("STANDARD")
  parentOrderId     String?
  replacementReason String?
  taxPst            Decimal         @default(0) @db.Decimal(10, 2)
  currency          Currency        @relation(fields: [currencyId], references: [id])
  parentOrder       Order?          @relation("OrderToOrder", fields: [parentOrderId], references: [id])
  childOrders       Order[]         @relation("OrderToOrder")
  billingName       String?
  billingAddress1   String?
  billingAddress2   String?
  billingCity       String?
  billingState      String?
  billingPostal     String?
  billingCountry    String?
  billingSameAsShipping Boolean       @default(true)
  items             OrderItem[]
  paymentErrors     PaymentError[]
  returnRequests    ReturnRequest[]

  @@index([createdAt])
  @@index([orderNumber])
  @@index([parentOrderId])
  @@index([paymentStatus])
  @@index([status])
  @@index([userId])
}

model PaymentError {
  id              String   @id @default(cuid())
  orderId         String?
  stripePaymentId String?
  errorType       String
  errorMessage    String
  amount          Float    @default(0)
  currency        String   @default("CAD")
  customerEmail   String?
  metadata        String?
  createdAt       DateTime @default(now())
  order           Order?   @relation(fields: [orderId], references: [id], onDelete: SetNull)

  @@index([createdAt])
  @@index([orderId])
  @@index([errorType])
}

model OrderItem {
  id          String   @id
  orderId     String
  productId   String
  formatId    String?
  productName String
  formatName  String?
  sku         String?
  quantity    Int
  unitPrice   Decimal  @db.Decimal(10, 2)
  discount    Decimal  @default(0) @db.Decimal(10, 2)
  total       Decimal  @db.Decimal(10, 2)
  createdAt   DateTime @default(now())
  order       Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([formatId])
  @@index([orderId])
  @@index([productId])
}

model Page {
  id              String            @id
  title           String
  slug            String            @unique
  content         String
  excerpt         String?
  metaTitle       String?
  metaDescription String?
  locale          String            @default("en")
  isPublished     Boolean           @default(false)
  publishedAt     DateTime?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime
  createdBy       String?
  template        String            @default("default")
  translations    PageTranslation[]

  @@index([isPublished])
  @@index([slug])
}

model PageTranslation {
  id              String             @id
  pageId          String
  locale          String
  title           String
  content         String
  metaTitle       String?
  metaDescription String?
  createdAt       DateTime           @default(now())
  updatedAt       DateTime
  contentHash     String?
  translatedBy    String?            @default("gpt-4o-mini")
  isApproved      Boolean            @default(false)
  qualityLevel    TranslationQuality @default(draft)
  page            Page               @relation(fields: [pageId], references: [id], onDelete: Cascade)

  @@unique([pageId, locale])
  @@index([locale])
  @@index([pageId])
}

model PasswordHistory {
  id        String   @id
  userId    String
  password  String
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([userId])
}

model PaymentMethodConfig {
  id          String   @id
  countryCode String
  methodType  String
  provider    String
  isActive    Boolean  @default(true)
  sortOrder   Int      @default(0)
  minAmount   Decimal? @db.Decimal(10, 2)
  maxAmount   Decimal? @db.Decimal(10, 2)
  createdAt   DateTime @default(now())
  updatedAt   DateTime

  @@unique([countryCode, methodType])
  @@index([countryCode, isActive])
}

model Permission {
  id               String                      @id
  code             String                      @unique
  name             String
  description      String?
  module           String
  defaultOwner     Boolean                     @default(true)
  defaultEmployee  Boolean                     @default(false)
  defaultClient    Boolean                     @default(false)
  defaultCustomer  Boolean                     @default(false)
  createdAt        DateTime                    @default(now())
  groupPermissions PermissionGroupPermission[]

  @@index([module])
}

model PermissionGroup {
  id          String                      @id
  name        String
  description String?
  color       String?
  isActive    Boolean                     @default(true)
  createdAt   DateTime                    @default(now())
  updatedAt   DateTime
  permissions PermissionGroupPermission[]
  users       UserPermissionGroup[]
}

model PermissionGroupPermission {
  id           String          @id
  groupId      String
  permissionId String
  createdAt    DateTime        @default(now())
  group        PermissionGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)
  permission   Permission      @relation(fields: [permissionId], references: [id], onDelete: Cascade)

  @@unique([groupId, permissionId])
  @@index([groupId])
  @@index([permissionId])
}

model PriceWatch {
  id            String    @id
  userId        String
  productId     String
  originalPrice Decimal   @db.Decimal(10, 2)
  targetPrice   Decimal?  @db.Decimal(10, 2)
  notified      Boolean   @default(false)
  notifiedAt    DateTime?
  createdAt     DateTime  @default(now())
  product       Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
  @@index([productId, notified])
}

model Product {
  id                  String               @id
  name                String
  subtitle            String?
  slug                String               @unique
  shortDescription    String?
  description         String?
  fullDetails         String?
  specifications      String?
  productType         ProductType          @default(PEPTIDE)
  price               Decimal              @db.Decimal(10, 2)
  compareAtPrice      Decimal?             @db.Decimal(10, 2)
  imageUrl            String?
  videoUrl            String?
  certificateUrl      String?
  certificateName     String?
  dataSheetUrl        String?
  dataSheetName       String?
  categoryId          String
  weight              Decimal?             @db.Decimal(10, 3)
  dimensions          String?
  requiresShipping    Boolean              @default(true)
  sku                 String?
  barcode             String?
  manufacturer        String?
  origin              String?
  purchaseCount       Int                  @default(0)
  averageRating       Decimal?             @db.Decimal(2, 1)
  reviewCount         Int                  @default(0)
  metaTitle           String?
  metaDescription     String?
  isActive            Boolean              @default(true)
  isFeatured          Boolean              @default(false)
  createdAt           DateTime             @default(now())
  updatedAt           DateTime
  allowBackorder      Boolean              @default(false)
  aminoSequence       String?
  casNumber           String?
  coaUrl              String?
  hplcUrl             String?
  isBestseller        Boolean              @default(false)
  isNew               Boolean              @default(false)
  molecularFormula    String?
  molecularWeight     Decimal?             @db.Decimal(10, 2)
  msdsUrl             String?
  purity              Decimal?             @db.Decimal(5, 2)
  storageConditions   String?
  tags                String?
  trackInventory      Boolean              @default(true)
  customSections      Json?
  participateResearch String?
  relatedResearch     String?
  researchSays        String?
  bundleItems         BundleItem[]
  courseAccesses      CourseAccess[]
  grades              Grade[]
  modules             Module[]
  priceWatches        PriceWatch[]
  category            Category             @relation(fields: [categoryId], references: [id])
  formats             ProductFormat[]
  images              ProductImage[]
  questions           ProductQuestion[]
  translations        ProductTranslation[]
  purchases           Purchase[]
  quantityDiscounts   QuantityDiscount[]
  reviews             Review[]
  stockAlerts         StockAlert[]
  upsellConfig        UpsellConfig?

  @@index([categoryId])
  @@index([isBestseller])
  @@index([isFeatured])
  @@index([isNew])
  @@index([productType])
  @@index([sku])
  @@index([slug])
}

model ProductFormat {
  id                String                     @id
  productId         String
  name              String
  description       String?
  price             Decimal                    @db.Decimal(10, 2)
  sku               String?                    @unique
  inStock           Boolean                    @default(true)
  stockQuantity     Int                        @default(0)
  sortOrder         Int                        @default(0)
  isDefault         Boolean                    @default(false)
  isActive          Boolean                    @default(true)
  createdAt         DateTime                   @default(now())
  updatedAt         DateTime
  availability      StockStatus                @default(IN_STOCK)
  availableDate     DateTime?
  barcode           String?
  comparePrice      Decimal?                   @db.Decimal(10, 2)
  discontinuedAt    DateTime?
  dosageMg          Decimal?                   @db.Decimal(10, 2)
  formatType        FormatType                 @default(VIAL_2ML)
  imageUrl          String?
  lowStockThreshold Int                        @default(5)
  trackInventory    Boolean                    @default(true)
  unitCount         Int?
  volumeMl          Decimal?                   @db.Decimal(10, 2)
  weightGrams       Int?
  costPrice         Decimal?                   @db.Decimal(10, 2)
  product           Product                    @relation(fields: [productId], references: [id], onDelete: Cascade)
  translations      ProductFormatTranslation[]

  @@index([availability])
  @@index([formatType])
  @@index([productId])
  @@index([sku])
}

model ProductFormatTranslation {
  id            String             @id
  formatId      String
  locale        String
  name          String?
  description   String?
  contentHash   String?
  translatedBy  String?            @default("gpt-4o-mini")
  isApproved    Boolean            @default(false)
  createdAt     DateTime           @default(now())
  updatedAt     DateTime
  qualityLevel  TranslationQuality @default(draft)
  productFormat ProductFormat      @relation(fields: [formatId], references: [id], onDelete: Cascade)

  @@unique([formatId, locale])
  @@index([formatId])
  @@index([locale])
}

model ProductImage {
  id        String   @id
  productId String
  url       String
  alt       String?
  caption   String?
  sortOrder Int      @default(0)
  isPrimary Boolean  @default(false)
  width     Int?
  height    Int?
  createdAt DateTime @default(now())
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
}

model ProductQuestion {
  id          String   @id
  userId      String
  productId   String
  question    String
  answer      String?
  answeredBy  String?
  isPublished Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  product     Product  @relation(fields: [productId], references: [id])
  user        User     @relation(fields: [userId], references: [id])

  @@index([isPublished])
  @@index([productId])
  @@index([userId])
}

model ProductTranslation {
  id                  String             @id
  productId           String
  locale              String
  name                String?
  subtitle            String?
  shortDescription    String?
  description         String?
  fullDetails         String?
  specifications      String?
  metaTitle           String?
  metaDescription     String?
  contentHash         String?
  translatedBy        String?            @default("gpt-4o-mini")
  isApproved          Boolean            @default(false)
  createdAt           DateTime           @default(now())
  updatedAt           DateTime
  customSections      Json?
  participateResearch String?
  relatedResearch     String?
  researchSays        String?
  qualityLevel        TranslationQuality @default(draft)
  product             Product            @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([productId, locale])
  @@index([locale])
  @@index([productId])
}

model PromoCode {
  id                String           @id
  code              String           @unique
  description       String?
  type              DiscountType     @default(PERCENTAGE)
  value             Decimal          @db.Decimal(10, 2)
  minOrderAmount    Decimal?         @db.Decimal(10, 2)
  maxDiscount       Decimal?         @db.Decimal(10, 2)
  usageLimit        Int?
  usageLimitPerUser Int?
  usageCount        Int              @default(0)
  startsAt          DateTime?
  endsAt            DateTime?
  firstOrderOnly    Boolean          @default(false)
  productIds        String?
  categoryIds       String?
  isActive          Boolean          @default(true)
  createdAt         DateTime         @default(now())
  updatedAt         DateTime
  usages            PromoCodeUsage[]

  @@index([code])
  @@index([isActive])
}

model PromoCodeUsage {
  id          String    @id
  promoCodeId String
  userId      String
  orderId     String?
  discount    Decimal   @db.Decimal(10, 2)
  usedAt      DateTime  @default(now())
  promoCode   PromoCode @relation(fields: [promoCodeId], references: [id], onDelete: Cascade)

  @@index([promoCodeId])
  @@index([usedAt])
  @@index([userId])
}

model Purchase {
  id              String         @id
  userId          String
  companyId       String?
  productId       String
  amount          Decimal        @db.Decimal(10, 2)
  currency        String         @default("CAD")
  paymentMethod   PaymentMethod
  stripePaymentId String?
  stripeInvoiceId String?
  paypalOrderId   String?
  status          PurchaseStatus @default(PENDING)
  receiptUrl      String?
  receiptNumber   String?        @unique
  createdAt       DateTime       @default(now())
  updatedAt       DateTime
  courseAccess    CourseAccess?
  company         Company?       @relation(fields: [companyId], references: [id])
  product         Product        @relation(fields: [productId], references: [id])
  user            User           @relation(fields: [userId], references: [id])
  shipping        Shipping?

  @@index([companyId])
  @@index([productId])
  @@index([status])
  @@index([userId])
}

model PurchaseOrder {
  id                String              @id
  poNumber          String              @unique
  supplierId        String?
  supplierName      String
  supplierEmail     String?
  department        String              @default("OPS")
  status            String              @default("DRAFT")
  requestedBy       String?
  approvedBy        String?
  approvedAt        DateTime?
  subtotal          Decimal             @default(0) @db.Decimal(12, 2)
  taxTps            Decimal             @default(0) @db.Decimal(12, 2)
  taxTvq            Decimal             @default(0) @db.Decimal(12, 2)
  total             Decimal             @default(0) @db.Decimal(12, 2)
  currency          String              @default("CAD")
  notes             String?
  supplierInvoiceId String?
  orderedAt         DateTime?
  receivedAt        DateTime?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  items             PurchaseOrderItem[]

  @@index([department])
  @@index([status])
  @@index([supplierId])
}

model PurchaseOrderItem {
  id              String        @id
  purchaseOrderId String
  description     String
  productId       String?
  formatId        String?
  sku             String?
  quantity        Int
  unitCost        Decimal       @db.Decimal(12, 2)
  total           Decimal       @db.Decimal(12, 2)
  receivedQty     Int           @default(0)
  createdAt       DateTime      @default(now())
  purchaseOrder   PurchaseOrder @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)

  @@index([purchaseOrderId])
}

model QuantityDiscount {
  id        String   @id
  productId String
  minQty    Int
  maxQty    Int?
  discount  Decimal  @db.Decimal(5, 2)
  createdAt DateTime @default(now())
  updatedAt DateTime
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([productId, minQty])
  @@index([productId])
}

model QuickReply {
  id           String                  @id
  title        String
  content      String
  category     String?
  sortOrder    Int                     @default(0)
  isActive     Boolean                 @default(true)
  createdAt    DateTime                @default(now())
  updatedAt    DateTime
  translations QuickReplyTranslation[]

  @@index([category])
}

model QuickReplyTranslation {
  id           String             @id
  quickReplyId String
  locale       String
  title        String?
  content      String?
  contentHash  String?
  translatedBy String?            @default("gpt-4o-mini")
  isApproved   Boolean            @default(false)
  createdAt    DateTime           @default(now())
  updatedAt    DateTime
  qualityLevel TranslationQuality @default(draft)
  quickReply   QuickReply         @relation(fields: [quickReplyId], references: [id], onDelete: Cascade)

  @@unique([quickReplyId, locale])
  @@index([locale])
  @@index([quickReplyId])
}

model Referral {
  id            String    @id
  referrerId    String
  referredId    String
  referralCode  String
  status        String    @default("PENDING")
  orderAmount   Decimal?  @db.Decimal(10, 2)
  pointsAwarded Int       @default(0)
  discountGiven Decimal?  @db.Decimal(10, 2)
  qualifiedAt   DateTime?
  rewardedAt    DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime
  referred      User      @relation("Referral_referredIdToUser", fields: [referredId], references: [id])
  referrer      User      @relation("Referral_referrerIdToUser", fields: [referrerId], references: [id])

  @@index([referralCode])
  @@index([referredId])
  @@index([referrerId])
}

model ReturnRequest {
  id          String   @id
  orderItemId String
  orderId     String
  userId      String
  reason      String
  details     String?
  status      String   @default("PENDING")
  resolution  String?
  adminNotes  String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  order       Order    @relation(fields: [orderId], references: [id])
  user        User     @relation(fields: [userId], references: [id])

  @@index([orderId])
  @@index([status])
  @@index([userId])
}

model Review {
  id           String        @id
  userId       String
  productId    String
  rating       Int
  title        String?
  comment      String?
  isVerified   Boolean       @default(false)
  isApproved   Boolean       @default(false)
  isPublished  Boolean       @default(false)
  reply        String?
  repliedAt    DateTime?
  helpfulCount Int           @default(0)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime
  product      Product       @relation(fields: [productId], references: [id])
  user         User          @relation(fields: [userId], references: [id])
  images       ReviewImage[]

  @@index([isApproved])
  @@index([productId])
  @@index([userId])
}

model ReviewImage {
  id        String   @id
  reviewId  String
  url       String
  alt       String?
  order     Int      @default(0)
  createdAt DateTime @default(now())
  review    Review   @relation(fields: [reviewId], references: [id], onDelete: Cascade)

  @@index([reviewId])
}

model SavedCard {
  id                    String   @id
  userId                String
  stripePaymentMethodId String   @unique
  brand                 String
  last4                 String
  expMonth              Int
  expYear               Int
  isDefault             Boolean  @default(false)
  createdAt             DateTime @default(now())
  user                  User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Session {
  id           String   @id
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Shipping {
  id                String                  @id
  purchaseId        String                  @unique
  recipientName     String
  addressLine1      String
  addressLine2      String?
  city              String
  state             String
  postalCode        String
  country           String                  @default("CA")
  phone             String?
  carrier           String?
  trackingNumber    String?
  trackingUrl       String?
  status            ShippingStatus          @default(PENDING)
  shippedAt         DateTime?
  estimatedDelivery DateTime?
  deliveredAt       DateTime?
  instructions      String?
  signature         Boolean                 @default(false)
  createdAt         DateTime                @default(now())
  updatedAt         DateTime
  purchase          Purchase                @relation(fields: [purchaseId], references: [id])
  statusHistory     ShippingStatusHistory[]

  @@index([status])
  @@index([trackingNumber])
}

model ShippingStatusHistory {
  id          String         @id
  shippingId  String
  status      ShippingStatus
  location    String?
  description String?
  createdAt   DateTime       @default(now())
  shipping    Shipping       @relation(fields: [shippingId], references: [id], onDelete: Cascade)

  @@index([shippingId])
}

model ShippingZone {
  id                    String   @id
  name                  String
  countries             String
  baseFee               Decimal  @db.Decimal(10, 2)
  perItemFee            Decimal  @default(0) @db.Decimal(10, 2)
  freeShippingThreshold Decimal? @db.Decimal(10, 2)
  estimatedDaysMin      Int      @default(3)
  estimatedDaysMax      Int      @default(7)
  maxWeight             Decimal? @db.Decimal(10, 3)
  isActive              Boolean  @default(true)
  notes                 String?
  sortOrder             Int      @default(0)
  createdAt             DateTime @default(now())
  updatedAt             DateTime

  @@index([isActive])
}

model SiteSetting {
  id          String   @id
  key         String   @unique
  value       String
  type        String   @default("text")
  module      String   @default("general")
  description String?
  updatedBy   String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime

  @@index([module])
}

model SiteSettings {
  id                    String   @id @default("default")
  companyName           String   @default("BioCycle Peptides")
  companyLegalName      String?
  companyDescription    String?
  logoUrl               String?
  email                 String?
  supportEmail          String?
  legalEmail            String?
  privacyEmail          String?
  phone                 String?
  address               String?
  city                  String?
  province              String?
  postalCode            String?
  country               String?  @default("CA")
  businessHours         String?
  socialLinks           String?
  freeShippingThreshold Decimal? @db.Decimal(10, 2)
  defaultCurrency       String   @default("CAD")
  newsletterEnabled     Boolean  @default(true)
  newsletterTitle       String?
  newsletterSubtitle    String?
  newsletterDiscount    Int?
  newsletterPromoCode   String?
  disclaimerEnabled     Boolean  @default(true)
  disclaimerTitle       String?
  disclaimerContent     String?
  disclaimerAgeMin      Int      @default(18)
  cookieBannerText      String?
  trustBadges           String?
  headerNav             String?
  footerNav             String?
  shippingRates         String?
  refundDays            Int      @default(30)
  refundProcessingDays  String?
  ambassadorTiers       String?
  rewardTiers           String?
  subscriptionFreqs     String?
  testimonials          String?
  statsJson             String?
  updatedAt             DateTime
}

model StockAlert {
  id         String    @id
  email      String
  productId  String
  formatId   String?
  notified   Boolean   @default(false)
  notifiedAt DateTime?
  createdAt  DateTime  @default(now())
  product    Product   @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([email, productId, formatId])
  @@index([email])
  @@index([productId, notified])
}

model Subscription {
  id              String    @id
  userId          String
  productId       String
  formatId        String?
  productName     String
  formatName      String?
  quantity        Int       @default(1)
  frequency       String    @default("MONTHLY")
  discountPercent Int       @default(10)
  unitPrice       Decimal   @db.Decimal(10, 2)
  status          String    @default("ACTIVE")
  nextDelivery    DateTime
  lastDelivery    DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime
  cancelledAt     DateTime?

  @@index([formatId])
  @@index([nextDelivery])
  @@index([productId])
  @@index([status])
  @@index([userId])
}

model SupplierInvoice {
  id              String        @id
  invoiceNumber   String
  supplierId      String?
  supplierName    String
  supplierEmail   String?
  subtotal        Decimal       @db.Decimal(12, 2)
  taxTps          Decimal       @default(0) @db.Decimal(12, 2)
  taxTvq          Decimal       @default(0) @db.Decimal(12, 2)
  taxOther        Decimal       @default(0) @db.Decimal(12, 2)
  total           Decimal       @db.Decimal(12, 2)
  amountPaid      Decimal       @default(0) @db.Decimal(12, 2)
  balance         Decimal       @db.Decimal(12, 2)
  currency        String        @default("CAD")
  invoiceDate     DateTime
  dueDate         DateTime
  paidAt          DateTime?
  status          InvoiceStatus @default(DRAFT)
  expenseCategory String?
  documentUrl     String?
  notes           String?
  journalEntryId  String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime

  @@index([dueDate])
  @@index([status])
  @@index([supplierId])
}

model TaxReport {
  id                String          @id
  period            String
  periodType        String          @default("MONTHLY")
  year              Int
  month             Int?
  quarter           Int?
  region            String
  regionCode        String
  tpsCollected      Decimal         @default(0) @db.Decimal(12, 2)
  tvqCollected      Decimal         @default(0) @db.Decimal(12, 2)
  tvhCollected      Decimal         @default(0) @db.Decimal(12, 2)
  otherTaxCollected Decimal         @default(0) @db.Decimal(12, 2)
  tpsPaid           Decimal         @default(0) @db.Decimal(12, 2)
  tvqPaid           Decimal         @default(0) @db.Decimal(12, 2)
  tvhPaid           Decimal         @default(0) @db.Decimal(12, 2)
  otherTaxPaid      Decimal         @default(0) @db.Decimal(12, 2)
  netTps            Decimal         @default(0) @db.Decimal(12, 2)
  netTvq            Decimal         @default(0) @db.Decimal(12, 2)
  netTvh            Decimal         @default(0) @db.Decimal(12, 2)
  netTotal          Decimal         @default(0) @db.Decimal(12, 2)
  salesCount        Int             @default(0)
  totalSales        Decimal         @default(0) @db.Decimal(12, 2)
  status            TaxReportStatus @default(DRAFT)
  generatedAt       DateTime        @default(now())
  filedAt           DateTime?
  paidAt            DateTime?
  dueDate           DateTime
  filingNumber      String?
  pdfUrl            String?
  notes             String?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime

  @@unique([regionCode, year, month])
  @@index([status])
  @@index([year])
}

model Testimonial {
  id            String                   @id
  name          String
  role          String?
  company       String?
  content       String
  rating        Int                      @default(5)
  imageUrl      String?
  videoUrl      String?
  videoDuration String?
  locale        String                   @default("en")
  isPublished   Boolean                  @default(true)
  isFeatured    Boolean                  @default(false)
  sortOrder     Int                      @default(0)
  createdAt     DateTime                 @default(now())
  updatedAt     DateTime
  translations  TestimonialTranslation[]

  @@index([isPublished])
  @@index([locale])
}

model TestimonialTranslation {
  id            String             @id
  testimonialId String
  locale        String
  content       String?
  role          String?
  createdAt     DateTime           @default(now())
  updatedAt     DateTime
  contentHash   String?
  translatedBy  String?            @default("gpt-4o-mini")
  isApproved    Boolean            @default(false)
  qualityLevel  TranslationQuality @default(draft)
  testimonial   Testimonial        @relation(fields: [testimonialId], references: [id], onDelete: Cascade)

  @@unique([testimonialId, locale])
  @@index([testimonialId])
}

model UatTestCase {
  id            String         @id
  runId         String
  scenarioCode  String
  scenarioName  String
  region        String
  status        String         @default("PENDING")
  orderId       String?
  orderNumber   String?
  expectedTaxes Json?
  actualTaxes   Json?
  expectedTotal Decimal?       @db.Decimal(12, 2)
  actualTotal   Decimal?       @db.Decimal(12, 2)
  verifications Json?
  durationMs    Int?
  startedAt     DateTime?
  completedAt   DateTime?
  createdAt     DateTime       @default(now())
  run           UatTestRun     @relation(fields: [runId], references: [id], onDelete: Cascade)
  errors        UatTestError[]

  @@index([runId])
  @@index([scenarioCode])
}

model UatTestError {
  id         String      @id
  testCaseId String
  category   String
  severity   String      @default("ERROR")
  message    String
  expected   String?
  actual     String?
  context    Json?
  stackTrace String?
  createdAt  DateTime    @default(now())
  testCase   UatTestCase @relation(fields: [testCaseId], references: [id], onDelete: Cascade)

  @@index([category])
  @@index([testCaseId])
}

model UatTestRun {
  id             String        @id
  runNumber      Int           @unique @default(autoincrement())
  status         String        @default("RUNNING")
  canadaOnly     Boolean       @default(true)
  totalScenarios Int           @default(0)
  passedCount    Int           @default(0)
  failedCount    Int           @default(0)
  skippedCount   Int           @default(0)
  startedAt      DateTime      @default(now())
  completedAt    DateTime?
  durationMs     Int?
  cleanedUp      Boolean       @default(false)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime
  testCases      UatTestCase[]
}

model User {
  id                     String                  @id
  email                  String                  @unique
  emailVerified          DateTime?
  name                   String?
  image                  String?
  password               String?
  role                   UserRole                @default(CUSTOMER)
  mfaEnabled             Boolean                 @default(false)
  mfaSecret              String?
  mfaBackupCodes         String?
  locale                 String                  @default("fr")
  timezone               String                  @default("America/Toronto")
  stripeCustomerId       String?                 @unique
  createdAt              DateTime                @default(now())
  updatedAt              DateTime
  birthDate              DateTime?
  lastBirthdayEmail      DateTime?
  lifetimePoints         Int                     @default(0)
  loyaltyPoints          Int                     @default(0)
  loyaltyTier            String                  @default("BRONZE")
  phone                  String?
  referralCode           String?                 @unique
  referredById           String?
  resetToken             String?
  resetTokenExpiry       DateTime?
  accounts               Account[]
  ambassadors            Ambassador[]
  company                Company?
  companyCustomers       CompanyCustomer[]
  assignedConversations  Conversation[]          @relation("Conversation_assignedToIdToUser")
  conversations          Conversation[]          @relation("Conversation_userIdToUser")
  courseAccesses         CourseAccess[]
  purchasedGiftCards     GiftCard[]              @relation("GiftCard_purchaserIdToUser")
  redeemedGiftCards      GiftCard[]              @relation("GiftCard_redeemedByToUser")
  grades                 Grade[]
  loyaltyTransactions    LoyaltyTransaction[]
  messages               Message[]
  notificationPreference NotificationPreference?
  passwordHistory        PasswordHistory[]
  priceWatches           PriceWatch[]
  productQuestions       ProductQuestion[]
  purchases              Purchase[]
  referralsReceived      Referral[]              @relation("Referral_referredIdToUser")
  referralsMade          Referral[]              @relation("Referral_referrerIdToUser")
  returnRequests         ReturnRequest[]
  reviews                Review[]
  savedCards             SavedCard[]
  sessions               Session[]
  addresses              UserAddress[]
  wishlistCollections    WishlistCollection[]

  @@index([email])
  @@index([role])
}

model UserAddress {
  id            String   @id
  userId        String
  label         String?
  recipientName String
  addressLine1  String
  addressLine2  String?
  city          String
  state         String
  postalCode    String
  country       String   @default("CA")
  phone         String?
  isDefault     Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model UserPermissionGroup {
  id         String          @id
  userId     String
  groupId    String
  assignedBy String?
  assignedAt DateTime        @default(now())
  group      PermissionGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)

  @@unique([userId, groupId])
  @@index([groupId])
  @@index([userId])
}

model UserPermissionOverride {
  id             String    @id
  userId         String
  permissionCode String
  granted        Boolean
  reason         String?
  grantedBy      String
  expiresAt      DateTime?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime

  @@unique([userId, permissionCode])
  @@index([permissionCode])
  @@index([userId])
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model Video {
  id           String             @id
  title        String
  slug         String             @unique
  description  String?
  thumbnailUrl String?
  videoUrl     String?
  duration     String?
  category     String?
  tags         String?
  instructor   String?
  views        Int                @default(0)
  isFeatured   Boolean            @default(false)
  isPublished  Boolean            @default(false)
  locale       String             @default("en")
  sortOrder    Int                @default(0)
  createdAt    DateTime           @default(now())
  updatedAt    DateTime
  translations VideoTranslation[]

  @@index([category])
  @@index([isPublished])
  @@index([slug])
}

model VideoTranslation {
  id           String             @id
  videoId      String
  locale       String
  title        String?
  description  String?
  contentHash  String?
  translatedBy String?            @default("gpt-4o-mini")
  isApproved   Boolean            @default(false)
  createdAt    DateTime           @default(now())
  updatedAt    DateTime
  qualityLevel TranslationQuality @default(draft)
  video        Video              @relation(fields: [videoId], references: [id], onDelete: Cascade)

  @@unique([videoId, locale])
  @@index([locale])
  @@index([videoId])
}

model WebhookEvent {
  id             String             @id
  eventId        String             @unique
  provider       String
  eventType      String
  status         WebhookEventStatus @default(PROCESSING)
  orderId        String?
  journalEntryId String?
  payload        String?
  errorMessage   String?
  processedAt    DateTime?
  createdAt      DateTime           @default(now())

  @@index([eventId])
  @@index([provider])
  @@index([status])
}

model Webinar {
  id              String               @id
  title           String
  slug            String               @unique
  description     String?
  thumbnailUrl    String?
  speaker         String?
  speakerTitle    String?
  speakerImage    String?
  scheduledAt     DateTime?
  duration        Int?
  category        String?
  tags            String?
  registrationUrl String?
  recordingUrl    String?
  maxAttendees    Int?
  registeredCount Int                  @default(0)
  isFeatured      Boolean              @default(false)
  isPublished     Boolean              @default(false)
  isLive          Boolean              @default(false)
  locale          String               @default("en")
  sortOrder       Int                  @default(0)
  createdAt       DateTime             @default(now())
  updatedAt       DateTime
  translations    WebinarTranslation[]

  @@index([isPublished])
  @@index([scheduledAt])
  @@index([slug])
}

model WebinarTranslation {
  id           String             @id
  webinarId    String
  locale       String
  title        String?
  description  String?
  speakerTitle String?
  contentHash  String?
  translatedBy String?            @default("gpt-4o-mini")
  isApproved   Boolean            @default(false)
  createdAt    DateTime           @default(now())
  updatedAt    DateTime
  qualityLevel TranslationQuality @default(draft)
  webinar      Webinar            @relation(fields: [webinarId], references: [id], onDelete: Cascade)

  @@unique([webinarId, locale])
  @@index([locale])
  @@index([webinarId])
}

model Wishlist {
  id        String   @id
  userId    String
  productId String
  createdAt DateTime @default(now())

  @@unique([userId, productId])
  @@index([productId])
  @@index([userId])
}

model WishlistCollection {
  id        String         @id
  userId    String
  name      String         @default("My Wishlist")
  isDefault Boolean        @default(false)
  createdAt DateTime       @default(now())
  updatedAt DateTime
  user      User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  items     WishlistItem[]

  @@index([userId])
}

model WishlistItem {
  id           String             @id
  collectionId String
  productId    String
  createdAt    DateTime           @default(now())
  collection   WishlistCollection @relation(fields: [collectionId], references: [id], onDelete: Cascade)

  @@unique([collectionId, productId])
  @@index([collectionId])
  @@index([productId])
}

model TranslationJob {
  id          String               @id @default(cuid())
  model       String
  entityId    String
  pass        Int                  @default(1)
  priority    Int                  @default(3)
  status      TranslationJobStatus @default(pending)
  retries     Int                  @default(0)
  maxRetries  Int                  @default(3)
  error       String?
  scheduledAt DateTime             @default(now())
  startedAt   DateTime?
  completedAt DateTime?
  createdAt   DateTime             @default(now())
  updatedAt   DateTime             @updatedAt

  @@unique([model, entityId, pass, status])
  @@index([status, priority, scheduledAt])
  @@index([model, entityId])
}

enum TranslationQuality {
  draft
  improved
  verified
  human
}

enum TranslationJobStatus {
  pending
  processing
  completed
  failed
}

model TranslationFeedback {
  id        String   @id @default(cuid())
  locale    String
  rating    String   // 'good' | 'bad'
  comment   String?
  page      String
  userAgent String?
  createdAt DateTime @default(now())

  @@index([locale, rating])
  @@index([createdAt])
}

model UpsellConfig {
  id                   String   @id @default(cuid())
  productId            String?  @unique
  isEnabled            Boolean  @default(true)
  showQuantityDiscount Boolean  @default(true)
  showSubscription     Boolean  @default(true)
  displayRule          String   @default("ALWAYS")
  quantityTitle        String?
  quantitySubtitle     String?
  subscriptionTitle    String?
  subscriptionSubtitle String?
  suggestedQuantity    Int?
  suggestedFrequency   String?
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
  product              Product? @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([isEnabled])
}

enum AccountType {
  ASSET
  LIABILITY
  EQUITY
  REVENUE
  EXPENSE
}

enum ChatSender {
  VISITOR
  ADMIN
  BOT
}

enum ChatStatus {
  ACTIVE
  WAITING_ADMIN
  CLOSED
  ARCHIVED
}

enum ConversationStatus {
  OPEN
  PENDING
  RESOLVED
  CLOSED
}

enum CreditNoteStatus {
  DRAFT
  ISSUED
  VOID
}

enum DiscountType {
  PERCENTAGE
  FIXED_AMOUNT
}

enum FormatType {
  VIAL_2ML
  VIAL_10ML
  CARTRIDGE_3ML
  KIT_12
  CAPSULE_60
  CAPSULE_120
  PACK_5
  PACK_10
  BUNDLE
  ACCESSORY
  NASAL_SPRAY
  CREAM
}

enum HeroMediaType {
  IMAGE
  VIDEO
  ANIMATION
}

enum InventoryReservationStatus {
  RESERVED
  RELEASED
  CONSUMED
}

enum InventoryTransactionType {
  PURCHASE
  SALE
  ADJUSTMENT
  RETURN
  LOSS
}

enum InvoiceStatus {
  DRAFT
  SENT
  PAID
  PARTIAL
  OVERDUE
  CANCELLED
  VOID
}

enum JournalEntryStatus {
  DRAFT
  POSTED
  VOIDED
}

enum JournalEntryType {
  MANUAL
  AUTO_SALE
  AUTO_REFUND
  AUTO_STRIPE_FEE
  AUTO_PAYPAL_FEE
  AUTO_SHIPPING
  AUTO_PURCHASE
  RECURRING
  ADJUSTMENT
  CLOSING
}

enum LoyaltyTransactionType {
  EARN_PURCHASE
  EARN_REFERRAL
  EARN_REVIEW
  EARN_SIGNUP
  EARN_BIRTHDAY
  EARN_BONUS
  REDEEM_DISCOUNT
  REDEEM_PRODUCT
  EXPIRE
  ADJUST
}

enum MessageType {
  TEXT
  IMAGE
  FILE
  SYSTEM
}

enum PaymentMethod {
  STRIPE_CARD
  APPLE_PAY
  GOOGLE_PAY
  PAYPAL
  VISA_CLICK_TO_PAY
  MASTERCARD_CLICK_TO_PAY
  AURELIA_PAY
}

enum ProductType {
  PEPTIDE
  SUPPLEMENT
  ACCESSORY
  BUNDLE
  CAPSULE
}

enum PurchaseStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

enum ReconciliationStatus {
  PENDING
  MATCHED
  UNMATCHED
  MANUAL
}

enum ShippingStatus {
  PENDING
  PROCESSING
  SHIPPED
  IN_TRANSIT
  OUT_FOR_DELIVERY
  DELIVERED
  FAILED
}

enum StockStatus {
  IN_STOCK
  OUT_OF_STOCK
  DISCONTINUED
  COMING_SOON
  PRE_ORDER
  LIMITED
}

enum TaxReportStatus {
  DRAFT
  GENERATED
  FILED
  PAID
}

enum UserRole {
  PUBLIC
  CUSTOMER
  CLIENT
  EMPLOYEE
  OWNER
}

enum WebhookEventStatus {
  PROCESSING
  COMPLETED
  FAILED
}
